<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kuiz BIG</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: url('https://png.pngtree.com/background/20250119/original/pngtree-elegant-luxury-a-realistic-grey-satin-wave-texture-on-fabric-picture-image_15305902.jpg') center/cover no-repeat fixed;
      min-height: 100vh;
    }
    .quiz-question { margin-bottom: 2.5rem; background: rgba(255,255,255,0.92); padding: 2rem; border-radius: 1rem; box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
  </style>
</head>
<body class="text-gray-800">
  <!-- Login -->
  <div id="login" class="flex items-center justify-center min-h-screen">
    <div class="max-w-md w-full p-10 bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl">
      <h1 class="text-4xl font-bold text-center mb-10">Login Kuiz BIG</h1>
      <select id="quizSelect" class="w-full p-4 border-2 rounded-lg mb-6 text-lg">
        <option value="1">Kuiz 1 (5%)</option>
        <option value="2">Kuiz 2 (5%)</option>
      </select>
      <input id="noKP" type="text" placeholder="No. Kad Pengenalan" class="w-full p-4 border-2 rounded-lg mb-8 text-lg">
      <button onclick="login()" class="w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-4 rounded-lg text-xl">Login</button>
    </div>
  </div>

  <!-- Quiz -->
  <div id="quiz" class="hidden max-w-5xl mx-auto mt-12 p-10 bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl">
    <div class="flex justify-between items-center mb-10">
      <h2 class="text-3xl font-bold">Selamat Datang, <span id="namaPelajar" class="text-blue-700"></span> (<span id="kelasPelajar" class="text-blue-700"></span>)</h2>
      <div id="timer" class="text-4xl font-bold text-red-600">Masa: 30:00</div>
    </div>
    <div id="questionsContainer" class="space-y-8"></div>
    <button onclick="submitQuiz()" class="mt-12 w-full bg-green-700 hover:bg-green-800 text-white font-bold py-5 rounded-lg text-2xl">Hantar Jawapan</button>
  </div>

  <!-- Results -->
  <div id="results" class="hidden max-w-4xl mx-auto mt-20 p-12 bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl text-center">
    <h2 class="text-5xl font-bold mb-8 text-green-700">Markah Anda: <span id="markah" class="text-6xl"></span>/30</h2>
    <p class="text-2xl mb-12">Tahniah! Hasil telah dicatat.</p>
    <button onclick="location.reload()" class="bg-blue-700 text-white py-4 px-12 rounded-lg text-xl">Kembali</button>
  </div>

<script>
  const API_URL = 'https://script.google.com/macros/s/AKfycbzS9a6BFQ2oAFCf4dmOTxkYvwC7nd6yMMtNAPm9i4nyJn5egyskNu1Pm7zlQW8ER6R8/exec'; // URL Apps Script anda
  let timeLeft = 1800;
  let timer;
  let cheatCount = 0;
  let questions = [];
  let userAnswers = [];
  let userData = {};

  // 30 SOALAN KUIZ 1 (lengkap shuffled, jawapan betul)
  const quiz1Questions = [
    {q: "Apakah peranan taklimat pengurusan risiko dalam pengurusan umum program BIG?", options: ["Untuk meningkatkan kos program tanpa sebab.", "Untuk menghadkan bilangan peserta.", "Untuk mengenal pasti dan mengurangkan risiko melalui analisis, strategi mitigasi, dan pelan kecemasan.", "Untuk mengabaikan aspek keselamatan peserta."], ans: "C"},
    {q: "Apakah tujuan post mortem selepas program BIG?", options: ["Mengabaikan maklum balas peserta.", "Menilai keberkesanan melalui analisis SWOT.", "Untuk meraikan kejayaan tanpa penilaian.", "Menambah kos program secara tidak perlu."], ans: "B"},
    {q: "Dalam penyediaan kertas kerja, apakah kandungan utama yang perlu dimasukkan mengenai program?", options: ["Kos peribadi pensyarah semata-mata.", "Jadual aktiviti, lokasi, sumber, dan keperluan logistik.", "Gambar lokasi tanpa penjelasan.", "Hanya nama peserta tanpa butiran program."], ans: "B"},
    {q: "Semasa lawatan tapak, apakah aspek yang perlu dipertimbangkan untuk memastikan kesesuaian lokasi perkhemahan?", options: ["Hanya kos sewa lokasi tanpa penilaian fizikal.", "Bilangan pokok di kawasan semata-mata.", "Kemudahan asas, keselamatan, aksesibiliti, dan ruang untuk aktiviti.", "Cuaca pada hari lawatan sahaja."], ans: "C"},
    {q: "Apakah langkah keselamatan utama semasa perkhemahan berdasarkan SOP?", options: ["Biarkan peserta bebas tanpa pengawasan.", "Pantau kesihatan peserta dan sediakan pengawasan ketat serta kit pertolongan cemas.", "Mengabaikan nombor kecemasan.", "Hanya fokus pada makanan sahaja."], ans: "B"},
    {q: "Apakah fokus utama taklimat SOP untuk peserta dan pengarah program?", options: ["Pengabaian prosedur standard.", "Pengurusan kewangan peribadi.", "Aspek keselamatan, disiplin, dan pengurusan masa.", "Hanya aktiviti hiburan semata-mata."], ans: "C"},
    {q: "Dalam pengurusan peralatan perkhemahan, apakah kepentingan senarai semak komprehensif?", options: ["Hanya untuk mengira bilangan khemah.", "Mengabaikan latihan penggunaan peralatan.", "Untuk membazirkan sumber tanpa perancangan.", "Memastikan peralatan lengkap dan berfungsi untuk keselesaan dan keselamatan."], ans: "D"},
    {q: "Apakah tujuan utama Program Bina Insan Guru (BIG) berdasarkan pengenalan program?", options: ["Memberi fokus kepada pengajaran mata pelajaran akademik semata-mata.", "Mengurangkan bilangan guru baru di sekolah.", "Menyediakan hiburan semata-mata untuk guru pelatih.", "Meningkatkan kemahiran guru dalam kepimpinan, komunikasi, dan pengurusan."], ans: "D"},
    {q: "Sebelum perkhemahan, apakah langkah pertama dalam persiapan peserta?", options: ["Melakukan aktiviti fizikal awal.", "Menyediakan laporan akhir.", "Menerima maklumat program.", "Mengabaikan borang kesihatan."], ans: "C"},
    {q: "Bagaimanakah program BIG memupuk nilai-nilai murni seperti integriti dan kerjasama?", options: ["Melalui aktiviti dan sesi refleksi.", "Dengan memberi kuliah teori semata-mata.", "Dengan mengabaikan taklimat keselamatan.", "Tanpa melibatkan peserta dalam projek berkumpulan."], ans: "A"},
    {q: "Semasa perkhemahan, bagaimanakah pengurusan masa dilaksanakan mengikut SOP?", options: ["Mengikut jadual ditetapkan dengan fleksibiliti untuk perubahan tidak dijangka.", "Tanpa jadual tetap untuk kebebasan peserta.", "Dengan mengabaikan aktiviti berkumpulan.", "Hanya pada hari pertama sahaja."], ans: "A"},
    {q: "Dalam konteks objektif program, apakah yang dimaksudkan dengan membangunkan kemahiran kepimpinan dalam kalangan guru pelatih?", options: ["Melibatkan kemahiran komunikasi, pengurusan, penyelesaian masalah, dan pengambilan keputusan.", "Hanya memfokuskan pada kemahiran mengajar subjek tertentu.", "Menekankan aktiviti individu tanpa kolaborasi.", "Mengabaikan aspek mental dan fizikal peserta."], ans: "A"},
    {q: "Apakah kaedah penilaian berkala semasa perkhemahan?", options: ["Untuk mengukur keberkesanan dan mengenal pasti bidang penambahbaikan.", "Tanpa melibatkan peserta.", "Fokus pada kos semata-mata.", "Hanya pada akhir program."], ans: "A"},
    {q: "Apakah aspek kognitif dalam penilaian peserta program BIG?", options: ["Hanya sikap peribadi.", "Kemahiran fizikal semata-mata.", "Pengetahuan dan pemahaman terhadap konsep kepimpinan.", "Mengabaikan prinsip amalan."], ans: "C"},
    {q: "Bagaimanakah penglibatan peserta digalakkan semasa aktiviti perkhemahan?", options: ["Dorong pengambilan bahagian aktif untuk membangunkan kemahiran kepimpinan dan kerjasama.", "Tanpa penilaian berkala.", "Mengabaikan dokumentasi aktiviti.", "Hadkan kepada aktiviti individu semata-mata."], ans: "A"},
    {q: "Apakah tujuan dokumentasi selepas perkhemahan?", options: ["Rekod dan simpan data penting untuk rujukan masa depan.", "Untuk dibuang selepas program.", "Hanya gambar peribadi.", "Tanpa penghantaran laporan."], ans: "A"},
    {q: "Bagaimanakah refleksi peserta dilaksanakan selepas program?", options: ["Hanya melalui laporan bertulis.", "Mereka diminta merefleksikan pengalaman dan pengajaran.", "Mengabaikan cabaran yang dihadapi.", "Tanpa sesi khusus."], ans: "B"},
    {q: "Apakah kepentingan komunikasi antara penyelaras dan peserta mengikut SOP?", options: ["Memberi taklimat terperinci mengenai program, peraturan, dan jadual.", "Tanpa aktiviti berkumpulan.", "Hanya berkongsi pendapat tanpa galakan.", "Mengabaikan soalan peserta."], ans: "A"},
    {q: "Apakah ciri kepimpinan yang diperlukan dalam program BIG?", options: ["Komunikasi jelas, keputusan tepat, dan pengurusan konflik.", "Mengabaikan keperluan peserta.", "Hanya motivasi tanpa kepekaan.", "Tanpa inspirasi pasukan."], ans: "A"},
    {q: "Dalam penghantaran laporan selepas program, kepada siapakah ia diserahkan?", options: ["Tanpa tujuan rasmi.", "Peserta sahaja.", "Pihak berkuasa berkaitan untuk pelaporan dan pertanggungjawaban.", "Ibu bapa semata-mata."], ans: "C"},
    {q: "Selepas perkhemahan, apakah fokus utama sesi penilaian?", options: ["Mengabaikan refleksi.", "Hanya pada peserta sahaja.", "Fokus pada kewangan semata-mata.", "Terhadap peserta, program, dan pengurusan."], ans: "D"},
    {q: "Apakah cabaran utama dalam pelaksanaan program BIG berkaitan SOP?", options: ["Lokasi selalu tersedia tanpa isu.", "Masa tidak terhad untuk perancangan.", "Komitmen mudah diperoleh.", "Pengurusan kewangan terhad yang menjejaskan aktiviti."], ans: "D"},
    {q: "Bagaimanakah aspek afektif dinilai dalam penilaian peserta?", options: ["Hanya kemahiran melaksanakan aktiviti.", "Sikap, nilai, dan motivasi terhadap pembangunan diri sebagai pendidik.", "Fokus pada pencapaian akademik.", "Tanpa melibatkan peranan pendidik."], ans: "B"},
    {q: "Mengapakah dokumentasi penting semasa perkhemahan?", options: ["Untuk rujukan dan penilaian program melalui gambar, video, dan nota.", "Mengabaikan aspek visual.", "Tanpa tujuan spesifik.", "Untuk hiburan peribadi sahaja."], ans: "A"},
    {q: "Bagaimanakah penglibatan ibu bapa dalam penyediaan peralatan?", options: ["Membantu menyediakan peralatan seperti khemah dan pakaian sesuai.", "Hanya sokongan moral semata-mata.", "Tanpa komunikasi dengan sekolah.", "Mengabaikan keperluan anak."], ans: "A"},
    {q: "Bagaimanakah komunikasi dengan ibu bapa dilaksanakan?", options: ["Tanpa maklumat prestasi.", "Mengabaikan tingkah laku anak.", "Hanya pada awal program.", "Melalui saluran seperti WhatsApp atau emel untuk maklumat perkembangan anak."], ans: "D"},
    {q: "Apakah peranan komunikasi antara peserta dalam program?", options: ["Membina semangat kerjasama melalui aktiviti berkumpulan.", "Hanya komunikasi formal.", "Mengabaikan persahabatan.", "Tanpa galakan berkongsi idea."], ans: "A"},
    {q: "Dalam pengurusan kewangan, apakah langkah perancangan bajet?", options: ["Hanya memperoleh dana tanpa pemantauan.", "Mengabaikan penyata kewangan.", "Menentukan kos keseluruhan termasuk penginapan dan makanan.", "Fokus pada sumbangan semata-mata."], ans: "C"},
    {q: "Apakah fokus aspek psikomotor dalam penilaian?", options: ["Kemahiran dan kebolehan dalam melaksanakan aktiviti kepimpinan.", "Mengabaikan pelaksanaan praktikal.", "Sikap sahaja tanpa kemahiran.", "Hanya pemahaman teori."], ans: "A"},
    {q: "Dalam refleksi peserta, apakah yang digalakkan mengenai peningkatan diri?", options: ["Fokus pada pengalaman lama sahaja.", "Hanya berkongsi cabaran tanpa pelajaran.", "Merenung pengalaman dan bagaimana program membantu pembangunan peribadi dan profesional.", "Mengabaikan sumbangan kepada komuniti."], ans: "C"}
  ];

  // 30 SOALAN KUIZ 2 (lengkap shuffled)
  const quiz2Questions = [
    {q: "Berdasarkan pengenalan, bagaimanakah program BIG dilaksanakan?", options: ["Mengabaikan sesi perkongsian.", "Hanya kuliah teori di kelas.", "Melalui gabungan kuliah, bengkel, aktiviti luar, dan sesi perkongsian.", "Tanpa aktiviti luar."], ans: "C"},
    {q: "Apakah objektif program dalam meningkatkan keyakinan diri guru pelatih?", options: ["Tanpa pembangunan keyakinan.", "Mengabaikan dunia pendidikan.", "Melalui aktiviti mencabar fizikal dan mental untuk mengatasi ketakutan.", "Hanya fokus pada motivasi tanpa cabaran."], ans: "C"},
    {q: "Bagaimanakah semangat kerja berpasukan dipupuk dalam program?", options: ["Tanpa komunikasi berkesan.", "Mengabaikan projek.", "Melalui aktiviti berkumpulan dan projek kolaborasi.", "Dengan aktiviti individu semata-mata."], ans: "C"},
    {q: "Dalam pengurusan umum, apakah kepentingan penyediaan kertas kerja?", options: ["Mengabaikan garis masa.", "Untuk kelulusan dan pembiayaan, merangkumi objektif dan anggaran.", "Tanpa butiran aktiviti.", "Hanya untuk rekod peribadi."], ans: "B"},
    {q: "Apakah fokus taklimat pengurusan risiko mengenai prosedur keselamatan?", options: ["Mengabaikan pertolongan cemas.", "Dijelaskan kepada semua pihak terlibat untuk keselamatan.", "Tanpa prosedur kecemasan.", "Hanya untuk peserta sahaja."], ans: "B"},
    {q: "Dalam taklimat SOP, apakah kandungan utama yang diliputi?", options: ["Prosedur aktiviti perkhemahan, keselamatan, kesihatan, dan kewangan.", "Tanpa aspek disiplin.", "Hanya pengurusan masa semata-mata.", "Mengabaikan komunikasi."], ans: "A"},
    {q: "Apakah tujuan taklimat SOP secara keseluruhan?", options: ["Memastikan kelancaran dengan mengurangkan risiko dan meningkatkan kecekapan.", "Hanya pengenalan ringkas.", "Untuk menambah beban peserta.", "Mengabaikan keberkesanan aktiviti."], ans: "A"},
    {q: "Semasa lawatan tapak, bagaimanakah ia membantu pengurusan program?", options: ["Hanya untuk gambar lokasi.", "Tanpa penilaian kemudahan.", "Memastikan kelancaran dan keselamatan dengan perancangan terperinci.", "Mengabaikan aksesibiliti."], ans: "C"},
    {q: "Dalam post mortem, apakah langkah pertama dalam penilaian?", options: ["Menganalisis keberkesanan dan pencapaian objektif.", "Mengabaikan maklum balas.", "Fokus pada kelemahan sahaja.", "Hanya cadangan tanpa refleksi."], ans: "A"},
    {q: "Apakah kepentingan pengagihan peralatan dalam pengurusan perkhemahan?", options: ["Mengabaikan keadilan.", "Dilakukan secara adil mengikut keperluan individu dan aktiviti.", "Tanpa mengambil kira jenis aktiviti.", "Hanya untuk kumpulan tertentu."], ans: "B"},
    {q: "Sebelum perkhemahan, apakah kepentingan pengumpulan data kesihatan?", options: ["Tanpa maklumat program.", "Hanya untuk peserta baru.", "Menyerahkan borang kesihatan untuk persiapan lengkap.", "Mengabaikan peralatan."], ans: "C"},
    {q: "Semasa perkhemahan, bagaimanakah penglibatan peserta mempengaruhi kemahiran?", options: ["Membantu membangunkan kepimpinan, kerjasama, dan tanggungjawab.", "Mengabaikan bertanggungjawab.", "Hanya pada aktiviti tertentu.", "Tanpa dorongan aktif."], ans: "A"},
    {q: "Apakah peranan penilaian berkala semasa program?", options: ["Mengukur keberkesanan dan bidang penambahbaikan.", "Mengabaikan bidang lemah.", "Tanpa kaitan dengan SOP.", "Hanya dokumentasi tanpa tindakan."], ans: "A"},
    {q: "Bagaimanakah dokumentasi dilaksanakan semasa aktiviti?", options: ["Melalui gambar, video, dan nota untuk rujukan.", "Tanpa nota ringkas.", "Hanya video semata-mata.", "Mengabaikan penilaian."], ans: "A"},
    {q: "Selepas perkhemahan, bagaimanakah sesi refleksi memberi impak?", options: ["Tanpa rekod data.", "Mengukur kejayaan dan aspek perlu diperbaiki.", "Mengabaikan laporan.", "Hanya penilaian peserta."], ans: "B"},
    {q: "Apakah aspek utama dalam penilaian peserta selepas program?", options: ["Tanpa psikomotor.", "Kognitif, afektif, dan psikomotor.", "Mengabaikan afektif.", "Hanya kognitif semata-mata."], ans: "B"},
    {q: "Dalam refleksi, bagaimanakah peserta berkongsi pengalaman pembelajaran?", options: ["Pembelajaran baharu, kemahiran ditingkatkan, dan penerapan dalam kerjaya.", "Mengabaikan perspektif.", "Hanya cabaran tanpa pelajaran.", "Tanpa sumbangan komuniti."], ans: "A"},
    {q: "Apakah peranan ibu bapa dalam sokongan moral untuk program?", options: ["Memberi galakan untuk meningkatkan keyakinan anak.", "Mengabaikan komunikasi.", "Hanya penyediaan peralatan.", "Tanpa minat terhadap program."], ans: "A"},
    {q: "Bagaimanakah komunikasi antara penyelaras dan ibu bapa memastikan maklumat?", options: ["Tanpa saluran mudah.", "Hanya emel semata-mata.", "Mengabaikan prestasi.", "Maklum tentang perkembangan, prestasi, dan tingkah laku anak."], ans: "D"},
    {q: "Apakah kepentingan komunikasi antara peserta untuk kerjasama?", options: ["Berkongsi idea dan saling membantu melalui aktiviti.", "Hanya komunikasi formal.", "Mengabaikan persahabatan.", "Tanpa galakan."], ans: "A"},
    {q: "Dalam pengurusan kewangan, apakah langkah pemantauan belanja?", options: ["Memantau perbelanjaan secara berkala untuk kecekapan.", "Hanya perancangan awal.", "Mengabaikan sumber dana.", "Tanpa penyata kewangan."], ans: "A"},
    {q: "Apakah ciri kepimpinan yang melibatkan motivasi dalam BIG?", options: ["Motivasi dan inspirasi kepada pasukan.", "Hanya keputusan tepat.", "Mengabaikan konflik.", "Tanpa komunikasi."], ans: "A"},
    {q: "Apakah cabaran berkaitan masa dalam pelaksanaan program?", options: ["Masa terhad untuk merancang, terutamanya bagi guru bertugas.", "Kewangan tidak terhad.", "Tanpa isu komitmen.", "Lokasi mudah dicari."], ans: "A"},
    {q: "Bagaimanakah penambahbaikan program dilakukan melalui kaji selidik?", options: ["Tanpa sesi bengkel.", "Mengabaikan kurikulum.", "Mendapat maklum balas daripada peserta, guru, dan ibu bapa.", "Hanya trend pendidikan."], ans: "C"},
    {q: "Apakah impak program BIG terhadap kemahiran guru?", options: ["Mengabaikan kolaborasi.", "Tanpa motivasi.", "Peningkatan pedagogi, kepimpinan, dan pengurusan kelas.", "Hanya pencapaian pelajar."], ans: "C"},
    {q: "Berdasarkan kejayaan peserta, apakah peratusan peningkatan keyakinan diri?", options: ["95% kenaikan tahap keyakinan dan motivasi.", "60% pencapaian akademik.", "80% kemahiran kepimpinan.", "75% penerapan nilai."], ans: "A"},
    {q: "Apakah inisiatif baharu dalam program BIG berkaitan teknologi?", options: ["Penggunaan simulasi pembelajaran dan aplikasi interaktif.", "Hanya yoga semata-mata.", "Mengabaikan kerjasama industri.", "Tanpa penekanan fizikal."], ans: "A"},
    {q: "Dalam kesimpulan program, apakah peranan BIG dalam pembangunan guru?", options: ["Membentuk sahsiah cemerlang melalui pengurusan teliti.", "Mengabaikan dedikasi.", "Tanpa objektif dicapai.", "Hanya untuk guru baru."], ans: "A"},
    {q: "Bagaimanakah SOP mempengaruhi pelaksanaan aktiviti luar seperti mendaki?", options: ["Hanya untuk berkayak.", "Memastikan kesesuaian kawasan dan keselamatan melalui lawatan tapak.", "Mengabaikan ruang penempatan.", "Tanpa pertimbangan aksesibiliti."], ans: "B"},
    {q: "Apakah langkah pencegahan dalam taklimat risiko untuk kelancaran program?", options: ["Mengabaikan pertolongan cemas.", "Menilai risiko untuk keselamatan peserta dan kelancaran.", "Hanya langkah umum tanpa spesifik.", "Tanpa prosedur keselamatan."], ans: "B"}
  ];

  function login() {
    navigator.geolocation.getCurrentPosition(pos => {
      const quiz = document.getElementById('quizSelect').value;
      const noKP = document.getElementById('noKP').value.trim();
      const params = `action=login&quiz=${quiz}&noKP=${noKP}&lat=${pos.coords.latitude}&long=${pos.coords.longitude}`;
      fetch(`${API_URL}?${params}`)
        .then(r => r.json())
        .then(data => {
          if (data.success) {
            userData = data.pelajar;
            document.getElementById('namaPelajar').innerText = userData.nama;
            document.getElementById('kelasPelajar').innerText = userData.kelas;
            questions = quiz === '1' ? [...quiz1Questions] : [...quiz2Questions];
            shuffleArray(questions);
            renderQuestions();
            document.getElementById('login').classList.add('hidden');
            document.getElementById('quiz').classList.remove('hidden');
            startTimer();
            detectCheat();
            requestFullscreen();
          } else {
            alert(data.msg || 'Login gagal');
          }
        })
        .catch(err => alert('Ralat sambungan ke server: ' + err));
    }, () => alert('Geolocation diperlukan'));
  }

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  function renderQuestions() {
    const container = document.getElementById('questionsContainer');
    container.innerHTML = '';
    questions.forEach((q, i) => {
      const div = document.createElement('div');
      div.className = 'quiz-question';
      div.innerHTML = `
        <p class="font-bold text-xl mb-4">${i+1}. ${q.q}</p>
        ${q.options.map((opt, j) => `
          <label class="block mb-3 cursor-pointer text-lg">
            <input type="radio" name="q${i}" value="${String.fromCharCode(65 + j)}" class="mr-3 transform scale-125">
            ${opt}
          </label>
        `).join('')}
      `;
      container.appendChild(div);
    });
  }

  function startTimer() {
    timer = setInterval(() => {
      timeLeft--;
      const min = String(Math.floor(timeLeft / 60)).padStart(2, '0');
      const sec = String(timeLeft % 60).padStart(2, '0');
      document.getElementById('timer').innerText = `Masa: ${min}:${sec}`;
      if (timeLeft <= 0) submitQuiz(true);
    }, 1000);
  }

  function detectCheat() {
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) cheatCount++;
      if (cheatCount > 2) {
        alert('Dikesan menukar tab! Kuiz dihantar automatik.');
        submitQuiz(true);
      }
    });
  }

  function requestFullscreen() {
    document.documentElement.requestFullscreen().catch(() => {});
  }

  function submitQuiz(auto = false) {
    clearInterval(timer);
    if (!auto && !confirm('Hantar jawapan sekarang?')) return;

    let score = 0;
    userAnswers = [];
    questions.forEach((q, i) => {
      const selected = document.querySelector(`input[name="q${i}"]:checked`);
      const answer = selected ? selected.value : 'Tiada';
      userAnswers.push(answer);
      if (answer === q.ans) score++;
    });

    document.getElementById('markah').innerText = score;
    document.getElementById('quiz').classList.add('hidden');
    document.getElementById('results').classList.remove('hidden');

    // Hantar hasil ke Sheet
    const quiz = document.getElementById('quizSelect').value;
    const params = new URLSearchParams({
      action: 'submit',
      quiz: quiz,
      noKP: document.getElementById('noKP').value.trim(),
      markah: score,
      answers: JSON.stringify(userAnswers),
      tarikh: new Date().toISOString().split('T')[0]
    });
    fetch(`${API_URL}?${params}`, {method: 'POST'})
      .then(() => console.log('Hasil berjaya dicatat ke Sheet'))
      .catch(err => alert('Hasil tempatan disimpan, tapi ralat hantar ke server: ' + err));
  }
</script>
</body>
</html>
